<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QR Code Email Capture</title>
  <script src="https://cdn.jsdelivr.net/npm/html5-qrcode/minified/html5-qrcode.min.js"></script>
</head>
<body>
  <h2>Scan QR Code to Capture Email</h2>
  <div id="qr-reader" style="width: 300px;"></div>
  <h3>Captured Emails</h3>
  <ul id="email-list"></ul>

  <script>
    const emailList = document.getElementById("email-list");
    const scriptURL = "https://script.google.com/macros/s/AKfycbyjgl0GK1AqZTxhgiq4H077dmVW9jlgC_ruTyu8Z8V8LVXbJEDIXaTluG12UJ5fG4AR/exec"; // Replace with your Apps Script URL

    function onScanSuccess(decodedText) {
      if (decodedText.includes("@")) {
        // Append to list in the web app
        const li = document.createElement("li");
        li.textContent = decodedText;
        emailList.appendChild(li);

        // Send email to Google Sheets
        fetch(scriptURL, {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams({ email: decodedText })
        })
        .then(response => console.log("Email added to Google Sheets"))
        .catch(error => console.error("Error!", error.message));
      }
    }

    const qrCodeScanner = new Html5Qrcode("qr-reader");
    qrCodeScanner.start(
      { facingMode: "environment" },
      { fps: 10, qrbox: { width: 250, height: 250 } },
      onScanSuccess
    );
  </script>
</body>
</html>